<template>
    <div class="portal-container">
        <!-- 공통 사이드바 -->
        <div class="sidebar">
            <div class="sidebar-header">
                <img src={logoUrl} alt="WE:GROW" class="sidebar-logo"/>
                <p class="sidebar-tagline">Work Smart, Grow Together</p>
            </div>

            <nav class="sidebar-nav">
                <div class={dashboardNavClass} onclick={navigateToDashboard}>
                    <span class="nav-icon">📊</span>
                    <span>대시보드</span>
                </div>
                <div class={myOfficeNavClass} onclick={navigateToMyOffice}>
                    <span class="nav-icon">🏢</span>
                    <span>나의 오피스</span>
                </div>
                <div class={chargeNavClass} onclick={navigateToCharge}>
                    <span class="nav-icon">💰</span>
                    <span>계약 및 청구</span>
                </div>

            </nav>

            <div class="sidebar-footer">
                <div class="user-profile">
                    <div class="user-avatar">👤</div>
                    <div class="user-info">
                        <p class="user-name">{userName}</p>
                        <p class="user-role">{companyName}</p>
                    </div>
                </div>
                <button class="btn-logout" onclick={handleLogout}>로그아웃</button>
            </div>
        </div>

        <!-- 메인 콘텐츠 영역 -->
        <div class="main-content">
            <!-- [TAB 1] 대시보드 -->
            <template if:true={isDashboardTab}>
                <div class="page-header dashboard-header">
                    <div class="header-title-row">
                        <h1 class="page-title">입주 현황 대시보드</h1>
                        <div class="welcome-badge">
                            <span class="emoji">👋</span>
                            <span>입주 준비가 진행 중입니다</span>
                        </div>
                    </div>
                    <p class="contract-date">입주일: {moveInDate} (D{daysUntilMoveIn})</p>
                </div>

                <div class="progress-section">
                    <div class="progress-tracker">
                        <div class="progress-step completed">
                            <div class="step-dot"></div>
                            <span class="step-label">계약 체결 완료</span>
                        </div>
                        <div class="progress-connector completed"></div>
                        <div class="progress-step completed">
                            <div class="step-dot"></div>
                            <span class="step-label">보증금 확인</span>
                        </div>
                        <div class="progress-connector active"></div>
                        <div class="progress-step active">
                            <div class="step-dot">
                                <div class="pulse-ring"></div>
                            </div>
                            <span class="step-label">입주 세팅 중</span>
                        </div>
                        <div class="progress-connector"></div>
                        <div class="progress-step">
                            <div class="step-dot"></div>
                            <span class="step-label">최종 점검</span>
                        </div>
                        <div class="progress-connector"></div>
                        <div class="progress-step">
                            <div class="step-dot"></div>
                            <span class="step-label">입주 완료</span>
                        </div>
                    </div>
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3>계약 공간</h3>
                            <span class="badge-success">계약 완료</span>
                        </div>
                        <div class="card-body">
                            <h2 class="location-title">{branchName}</h2>
                            <p class="location-detail">{officeName} ({capacity}인실)</p>
                            
                            <div class="info-list">
                                <div class="info-row">
                                    <span class="info-label">출입 카드</span>
                                    <span class="info-value">20장 발급 예정</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">주차 배정</span>
                                    <span class="info-value">무료 2대</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">도어락 PW</span>
                                    <span class="info-value">입주 당일 공개</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>이번 달 청구 예정액</h3>
                        </div>
                        <div class="card-body">
                            <h2 class="billing-amount">{monthlyPayment}</h2>
                            <p class="billing-note">(부가세 포함 VAT Included)</p>
                            
                            <div class="billing-breakdown">
                                <div class="breakdown-row">
                                    <span class="breakdown-label">월 이용료 (임대료+관리비)</span>
                                    <span class="breakdown-value">{monthlyPayment}</span>
                                </div>
                                <div class="breakdown-row highlight">
                                    <span class="breakdown-label">🎉 입주 청소비 (특별)</span>
                                    <span class="breakdown-value discount">0 원 (면제)</span>
                                </div>
                            </div>
                            <a onclick={openInvoice} class="link-text">견적서/청구서 다운로드</a>
                        </div>
                    </div>

                    <div class="card card-wide">
                        <div class="card-header">
                            <h3>민원 접수 현황</h3>
                            <span class="case-count-badge">{caseCountText}</span>
                        </div>
                        <div class="card-body">
                            <template if:true={hasCases}>
                                <div class="case-list">
                                    <template for:each={recentCases} for:item="caseItem">
                                        <div key={caseItem.Id} class="case-item">
                                            <div class="case-icon">{caseItem.icon}</div>
                                            <div class="case-content">
                                                <h4 class="case-subject">{caseItem.Subject}</h4>
                                                <div class="case-meta">
                                                    <span class="case-type">{caseItem.Type}</span>
                                                    <span class="case-date">접수일: {caseItem.CreatedDateFormatted}</span>
                                                </div>
                                            </div>
                                            <div class={caseItem.statusClass}>{caseItem.Status}</div>
                                        </div>
                                    </template>
                                </div>
                            </template>
                            <template if:false={hasCases}>
                                <div class="empty-state">
                                    <div class="empty-icon">📋</div>
                                    <p class="empty-title">현재 접수된 민원이 없습니다</p>
                                    <p class="empty-subtitle">문의사항이 있으시면 우측 하단 채팅을 이용해주세요</p>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </template>

            <!-- [TAB 2] 나의 오피스 -->
            <template if:true={isMyOfficeTab}>
                <div class="page-header">
                    <h1 class="page-title">나의 오피스 정보</h1>
                    <span class="status-badge-active">계약 중 (Active)</span>
                </div>

                <div class="office-banner" style={bannerStyle}>
                    <div class="banner-overlay">
                        <h2 class="office-name">{officeFullName}</h2>
                        <p class="office-type">{capacity}인실 {productName}</p>
                    </div>
                </div>

                <div class="office-stats">
                    <div class="stat-item">
                        <p class="stat-label">총 면적</p>
                        <p class="stat-value">85 ㎡</p>
                    </div>
                    <div class="stat-item">
                        <p class="stat-label">수용 인원</p>
                        <p class="stat-value">{capacity} 명</p>
                    </div>
                    <div class="stat-item">
                        <p class="stat-label">창문 뷰</p>
                        <p class="stat-value">후면 (View)</p>
                    </div>
                    <div class="stat-item">
                        <p class="stat-label">냉난방</p>
                        <p class="stat-value">개별 제어</p>
                    </div>
                </div>

                <div class="content-grid">
                    <div class="left-column">
                        <div class="info-card">
                            <h3 class="card-title">보안 및 출입 정보</h3>
                            <div class="info-section">
                                <div class="info-row-detail">
                                    <span class="info-icon">🔐</span>
                                    <div class="info-content">
                                        <p class="info-title">도어락 비밀번호</p>
                                        <p class="info-value-large">{doorLockPwDisplay}</p>
                                        <p class="info-note">* 초기 비밀번호입니다. 입주 후 변경해주세요.</p>
                                    </div>
                                    <button class="btn-small" onclick={toggleDoorLockPw}>{doorLockToggleText}</button>
                                </div>
                                <div class="info-row-detail">
                                    <span class="info-icon">📶</span>
                                    <div class="info-content">
                                        <p class="info-title">전용 Wi-Fi</p>
                                        <p class="info-value-wifi">{wifiSsid}</p>
                                        <p class="info-note">PW: {wifiPassword}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="progress-bar-mini">
                                <div class="progress-fill" style="width: 75%;"></div>
                            </div>
                            <p class="progress-note">출입 카드 현황: 24장 발급완료</p>
                            <p class="info-note-small">* 추가 발급은 '시설 및 민원' 탭에서 신청하세요.</p>
                        </div>

                        <div class="info-card">
                            <h3 class="card-title">공간 배치도</h3>
                            <div class="layout-image-container">
                                <img src={officeMockupUrl} alt="공간 배치도" class="layout-image"/>
                            </div>
                        </div>
                    </div>

                    <div class="right-column">
                        <div class="info-card">
                            <h3 class="card-title">계약 요약</h3>
                            <div class="contract-info">
                                <div class="contract-row">
                                    <span class="contract-label">계약 기간</span>
                                    <span class="contract-value">{contractStartDate}</span>
                                    <span class="contract-sub">~ {contractEndDate}</span>
                                </div>
                                <div class="contract-row">
                                    <span class="contract-label">보증금</span>
                                    <span class="contract-value">{depositAmount}</span>
                                </div>
                                <div class="contract-row">
                                    <span class="contract-label">월 이용료</span>
                                    <span class="contract-value">{monthlyPayment}</span>
                                </div>
                                <div class="contract-row highlight">
                                    <span class="contract-label">재계약 알림</span>
                                    <span class="contract-value warning">D-{daysUntilContractEnd}</span>
                                </div>
                            </div>
                        </div>

                        <div class="info-card">
                            <h3 class="card-title">시설 담당자</h3>
                            <div class="facility-team">
                                <div class="team-member">
                                    <div class="member-icon">👤</div>
                                    <div class="member-info">
                                        <p class="member-name">이민수 주임</p>
                                        <p class="member-role">Facility Team</p>
                                    </div>
                                </div>
                                <p class="contact-info">📞 02-1234-5678</p>
                            </div>
                        </div>
                    </div>
                </div>
            </template>

            <!-- [TAB 3] 계약 및 청구 -->
            <template if:true={isChargeTab}>
                <div class="page-header">
                    <h1 class="page-title">계약 및 청구 관리</h1>
                    <button class="btn-download" onclick={openContract}>전자계약서(PDF) 다운로드</button>
                </div>

                <div class="contract-header-card">
                    <div class="contract-info-section">
                        <h2 class="contract-main-title">{branchName} {capacity}인실 임대 계약</h2>
                        <span class="status-badge active">Active (계약 중)</span>
                        <p class="contract-subtitle">계약 번호: {contractNumber}</p>
                    </div>
                    <div class="contract-details-grid">
                        <div class="detail-box">
                            <p class="detail-label">계약 기간</p>
                            <p class="detail-value">{contractStartDate} ~ {contractEndDate}</p>
                            <p class="detail-link highlight">재계약 협상 가능 (D-{daysUntilContractEnd})</p>
                        </div>
                        <div class="detail-box">
                            <p class="detail-label">보증금 (Deposit)</p>
                            <p class="detail-value">{depositAmount}</p>
                            <p class="detail-link success">납부 완료 (Paid)</p>
                        </div>
                        <div class="detail-box">
                            <p class="detail-label">월 이용료 (Monthly)</p>
                            <p class="detail-value">{monthlyPayment}</p>
                            <p class="detail-note">(부가세 포함)</p>
                        </div>
                        <div class="detail-box">
                            <p class="detail-label">납부일</p>
                            <p class="detail-value">{billingCycle}</p>
                            <p class="detail-note">(익월 결제)</p>
                        </div>
                    </div>
                </div>

                <div class="content-grid charge-grid">
                    <div class="billing-section">
                        <div class="section-header-row">
                            <h3>청구 및 납부 내역</h3>
                            <select class="year-selector">
                                <option>2024년</option>
                                <option>2023년</option>
                            </select>
                        </div>

                        <table class="billing-table">
                            <thead>
                                <tr>
                                    <th>청구월</th>
                                    <th>청구 금액</th>
                                    <th>납부 기한</th>
                                    <th>상태</th>
                                    <th>영수증</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="urgent">
                                    <td>2024년 11월분</td>
                                    <td>5,500,000 원</td>
                                    <td class="due-date">2024.10.25 (D-1)</td>
                                    <td><span class="status-tag unpaid">미납 (Unpaid)</span></td>
                                    <td><a onclick={openReceipt} class="link-pdf">PDF 보기</a></td>
                                </tr>
                                <tr>
                                    <td>2024년 10월분</td>
                                    <td>5,500,000 원</td>
                                    <td>2024.09.25</td>
                                    <td><span class="status-tag paid">납부 완료</span></td>
                                    <td><a onclick={openReceipt} class="link-pdf">PDF 보기</a></td>
                                </tr>
                                <tr>
                                    <td>보증금 (Deposit)</td>
                                    <td>100,000,000 원</td>
                                    <td>2024.10.12</td>
                                    <td><span class="status-tag paid">납부 완료</span></td>
                                    <td><a onclick={openReceipt} class="link-pdf">PDF 보기</a></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="info-section">
                        <div class="info-card">
                            <h3 class="card-title">납부 계좌 정보</h3>
                            <div class="account-info-highlight">
                                <p class="account-label">입금 가상계좌 (Virtual Account)</p>
                                <p class="account-number">우리 1002-123-456789</p>
                                <p class="account-holder">예금주: (주)위그로우_블루테크</p>
                            </div>
                            <p class="info-note warning-text">
                                * 납부 기한이 지난 경우, 익월 10일까지 미납 시 연체료가 부과될 수 있습니다.
                            </p>
                            <p class="info-note">
                                납부 기한 경과 시 3영업일 이내 연체료 12%가 부과될 수 있습니다.
                            </p>
                        </div>

                        <div class="info-card">
                            <h3 class="card-title">세금계산서 정보</h3>
                            <div class="tax-info">
                                <div class="tax-row">
                                    <span class="tax-label">사업자 번호</span>
                                    <span class="tax-value">{bizRegistrationNo}</span>
                                </div>
                                <div class="tax-row">
                                    <span class="tax-label">상호명</span>
                                    <span class="tax-value">{companyName}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </template>



        </div>
    </div>
</template>
