<template>
    <div class="portal-container">
        <!-- ê³µí†µ ì‚¬ì´ë“œë°” -->
        <div class="sidebar">
            <div class="sidebar-header">
                <img src={logoUrl} alt="WE:GROW" class="sidebar-logo"/>
                <p class="sidebar-tagline">Work Smart, Grow Together</p>
            </div>

            <nav class="sidebar-nav">
                <div class={dashboardNavClass} onclick={navigateToDashboard}>
                    <span class="nav-icon">ğŸ“Š</span>
                    <span>ëŒ€ì‹œë³´ë“œ</span>
                </div>
                <div class={myOfficeNavClass} onclick={navigateToMyOffice}>
                    <span class="nav-icon">ğŸ¢</span>
                    <span>ë‚˜ì˜ ì˜¤í”¼ìŠ¤</span>
                </div>
                <div class={chargeNavClass} onclick={navigateToCharge}>
                    <span class="nav-icon">ğŸ’°</span>
                    <span>ê³„ì•½ ë° ì²­êµ¬</span>
                </div>

            </nav>

            <div class="sidebar-footer">
                <div class="user-profile">
                    <div class="user-avatar">ğŸ‘¤</div>
                    <div class="user-info">
                        <p class="user-name">{userName}</p>
                        <p class="user-role">{companyName}</p>
                    </div>
                </div>
                <button class="btn-logout" onclick={handleLogout}>ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>

        <!-- ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ -->
        <div class="main-content">
            <!-- [TAB 1] ëŒ€ì‹œë³´ë“œ -->
            <template if:true={isDashboardTab}>
                <div class="page-header dashboard-header">
                    <div class="header-title-row">
                        <h1 class="page-title">ì…ì£¼ í˜„í™© ëŒ€ì‹œë³´ë“œ</h1>
                        <div class="welcome-badge">
                            <span class="emoji">ğŸ‘‹</span>
                            <span>ì…ì£¼ ì¤€ë¹„ê°€ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤</span>
                        </div>
                    </div>
                    <p class="contract-date">ì…ì£¼ì¼: {moveInDate} ({moveInDayDisplay})</p>
                </div>

                <template if:false={isNormalMode}>
                    <div class="progress-section">
                        <div class="progress-header">
                            <h3 class="progress-title">{progressTitle}</h3>
                            <p class="progress-subtitle">{progressSubtitle}</p>
                        </div>
                        <div class="progress-tracker">
                            <template for:each={progressSteps} for:item="step" for:index="idx">
                                <template if:true={idx}>
                                    <div key={step.label} class={step.connectorClass}></div>
                                </template>
                                <div key={step.label} class={step.stepClass}>
                                    <div class="step-dot">
                                        <template if:true={step.isActive}>
                                            <div class="pulse-ring"></div>
                                        </template>
                                    </div>
                                    <span class="step-label">{step.label}</span>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>

                <template if:true={isNormalMode}>
                    <div class="normal-status-card">
                        <div class="normal-status-icon">ğŸ¢</div>
                        <div class="normal-status-content">
                            <h3>í˜„ì¬ ì •ìƒ ì´ìš© ì¤‘ì…ë‹ˆë‹¤</h3>
                            <p>ê³„ì•½ ë§Œë£Œì¼: {contractEndDate} (D-{daysUntilContractEnd})</p>
                        </div>
                    </div>
                </template>

                <div class="cards-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3>ê³„ì•½ ê³µê°„</h3>
                            <span class="badge-success">ê³„ì•½ ì™„ë£Œ</span>
                        </div>
                        <div class="card-body">
                            <h2 class="location-title">{branchName}</h2>
                            <p class="location-detail">{officeName} ({capacity}ì¸ì‹¤)</p>
                            
                            <div class="info-list">
                                <p class="info-note-link">ìƒì„¸ ì •ë³´ëŠ” <a onclick={navigateToMyOffice} class="link-text">'ë‚˜ì˜ ì˜¤í”¼ìŠ¤'</a> íƒ­ì—ì„œ í™•ì¸í•˜ì„¸ìš”.</p>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>ì´ë²ˆ ë‹¬ ì²­êµ¬ ì˜ˆì •ì•¡</h3>
                        </div>
                        <div class="card-body">
                            <h2 class="billing-amount">{monthlyPayment}</h2>
                            <p class="billing-note">(ë¶€ê°€ì„¸ í¬í•¨ VAT Included)</p>
                            
                            <div class="billing-breakdown">
                                <div class="breakdown-row">
                                    <span class="breakdown-label">ì›” ì´ìš©ë£Œ (ì„ëŒ€ë£Œ+ê´€ë¦¬ë¹„)</span>
                                    <span class="breakdown-value">{monthlyPayment}</span>
                                </div>
                                <div class="breakdown-row highlight">
                                    <span class="breakdown-label">ğŸ‰ ì…ì£¼ ì²­ì†Œë¹„ (íŠ¹ë³„)</span>
                                    <span class="breakdown-value discount">0 ì› (ë©´ì œ)</span>
                                </div>
                            </div>
                            <a onclick={openInvoice} class="link-text">ê²¬ì ì„œ/ì²­êµ¬ì„œ ë‹¤ìš´ë¡œë“œ</a>
                        </div>
                    </div>

                    <div class="card card-wide">
                        <div class="card-header">
                            <h3>ë¯¼ì› ì ‘ìˆ˜ í˜„í™©</h3>
                            <span class="case-count-badge">{caseCountText}</span>
                        </div>
                        <div class="card-body">
                            <template if:true={hasCases}>
                                <div class="case-list">
                                    <template for:each={recentCases} for:item="caseItem">
                                        <div key={caseItem.caseId} class="case-item clickable" data-id={caseItem.caseId} onclick={handleCaseClick}>
                                            <div class="case-icon">{caseItem.icon}</div>
                                            <div class="case-content">
                                                <h4 class="case-subject">{caseItem.subject}</h4>
                                                <div class="case-meta">
                                                    <span class="case-type">{caseItem.caseType}</span>
                                                    <span class="case-date">ì ‘ìˆ˜ì¼: {caseItem.CreatedDateFormatted}</span>
                                                </div>
                                            </div>
                                            <div class={caseItem.statusClass}>{caseItem.status}</div>
                                        </div>
                                    </template>
                                </div>
                            </template>
                            <template if:false={hasCases}>
                                <div class="empty-state">
                                    <div class="empty-icon">ğŸ“‹</div>
                                    <p class="empty-title">í˜„ì¬ ì ‘ìˆ˜ëœ ë¯¼ì›ì´ ì—†ìŠµë‹ˆë‹¤</p>
                                    <p class="empty-subtitle">ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ìš°ì¸¡ í•˜ë‹¨ ì±„íŒ…ì„ ì´ìš©í•´ì£¼ì„¸ìš”</p>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </template>

            <!-- [TAB 2] ë‚˜ì˜ ì˜¤í”¼ìŠ¤ -->
            <template if:true={isMyOfficeTab}>
                <div class="page-header">
                    <h1 class="page-title">ë‚˜ì˜ ì˜¤í”¼ìŠ¤ ì •ë³´</h1>
                    <span class="status-badge-active">ê³„ì•½ ì¤‘ (Active)</span>
                </div>

                <div class="office-banner" style={bannerStyle}>
                    <div class="banner-overlay">
                        <h2 class="office-name">{officeFullName}</h2>
                        <p class="office-type">{capacity}ì¸ì‹¤ {productName}</p>
                    </div>
                </div>

                <div class="office-stats">
                    <div class="stat-item">
                        <p class="stat-label">ì´ ë©´ì </p>
                        <p class="stat-value">85 ã¡</p>
                    </div>
                    <div class="stat-item">
                        <p class="stat-label">ìˆ˜ìš© ì¸ì›</p>
                        <p class="stat-value">{capacity} ëª…</p>
                    </div>
                    <div class="stat-item">
                        <p class="stat-label">ì°½ë¬¸ ë·°</p>
                        <p class="stat-value">í›„ë©´ (View)</p>
                    </div>
                    <div class="stat-item">
                        <p class="stat-label">ëƒ‰ë‚œë°©</p>
                        <p class="stat-value">ê°œë³„ ì œì–´</p>
                    </div>
                </div>

                <div class="content-grid">
                    <div class="left-column">
                        <div class="info-card">
                            <h3 class="card-title">ë³´ì•ˆ ë° ì¶œì… ì •ë³´</h3>
                            <div class="info-section">
                                <div class="info-row-detail">
                                    <span class="info-icon">ğŸ”</span>
                                    <div class="info-content">
                                        <p class="info-title">ë„ì–´ë½ ë¹„ë°€ë²ˆí˜¸</p>
                                        <p class="info-value-large">{doorLockPwDisplay}</p>
                                        <p class="info-note">* ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤. ì…ì£¼ í›„ ë³€ê²½í•´ì£¼ì„¸ìš”.</p>
                                    </div>
                                    <button class="btn-small" onclick={toggleDoorLockPw}>{doorLockToggleText}</button>
                                </div>
                                <div class="info-row-detail">
                                    <span class="info-icon">ğŸ“¶</span>
                                    <div class="info-content">
                                        <p class="info-title">ì „ìš© Wi-Fi</p>
                                        <p class="info-value-wifi">{wifiSsid}</p>
                                        <p class="info-note">PW: {wifiPassword}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="progress-bar-mini">
                                <div class="progress-fill" style="width: 75%;"></div>
                            </div>
                            <p class="progress-note">ì¶œì… ì¹´ë“œ í˜„í™©: 24ì¥ ë°œê¸‰ì™„ë£Œ</p>
                            <p class="info-note-small">* ì¶”ê°€ ë°œê¸‰ì€ ìš°ì¸¡ í•˜ë‹¨ ì±„íŒ…ì„ í†µí•´ ë¬¸ì˜í•´ì£¼ì„¸ìš”.</p>
                        </div>

                        <div class="info-card">
                            <h3 class="card-title">ê³µê°„ ë°°ì¹˜ë„</h3>
                            <div class="layout-image-container">
                                <img src={officeMockupUrl} alt="ê³µê°„ ë°°ì¹˜ë„" class="layout-image"/>
                            </div>
                        </div>
                    </div>

                    <div class="right-column">
                        <div class="info-card">
                            <h3 class="card-title">ê³„ì•½ ìš”ì•½</h3>
                            <div class="contract-info">
                                <div class="contract-row">
                                    <span class="contract-label">ê³„ì•½ ê¸°ê°„</span>
                                    <span class="contract-value">{contractStartDate}</span>
                                    <span class="contract-sub">~ {contractEndDate}</span>
                                </div>
                                <div class="contract-row">
                                    <span class="contract-label">ë³´ì¦ê¸ˆ</span>
                                    <span class="contract-value">{depositAmount}</span>
                                </div>
                                <div class="contract-row">
                                    <span class="contract-label">ì›” ì´ìš©ë£Œ</span>
                                    <span class="contract-value">{monthlyPayment}</span>
                                </div>
                                <div class="contract-row highlight">
                                    <span class="contract-label">ì¬ê³„ì•½ ì•Œë¦¼</span>
                                    <span class="contract-value warning">D-{daysUntilContractEnd}</span>
                                </div>
                            </div>
                        </div>

                        <div class="info-card">
                            <h3 class="card-title">ì‹œì„¤ ë‹´ë‹¹ì</h3>
                            <div class="facility-team">
                                <div class="team-member">
                                    <div class="member-icon">ğŸ‘¤</div>
                                    <div class="member-info">
                                        <p class="member-name">ì„±ì›í˜¸ ì£¼ì„</p>
                                        <p class="member-role">Facility Team</p>
                                    </div>
                                </div>
                                <p class="contact-info">ğŸ“ 02-1234-5678</p>
                            </div>
                        </div>
                    </div>
                </div>
            </template>

            <!-- [TAB 3] ê³„ì•½ ë° ì²­êµ¬ -->
            <template if:true={isChargeTab}>
                <div class="page-header">
                    <h1 class="page-title">ê³„ì•½ ë° ì²­êµ¬ ê´€ë¦¬</h1>
                    <button class="btn-download" onclick={openContract}>ì „ìê³„ì•½ì„œ(PDF) ë‹¤ìš´ë¡œë“œ</button>
                </div>

                <div class="contract-header-card">
                    <div class="contract-info-section">
                        <h2 class="contract-main-title">{branchName} {capacity}ì¸ì‹¤ ì„ëŒ€ ê³„ì•½</h2>
                        <span class="status-badge active">Active (ê³„ì•½ ì¤‘)</span>
                        <p class="contract-subtitle">ê³„ì•½ ë²ˆí˜¸: {contractNumber}</p>
                    </div>
                    <div class="contract-details-grid">
                        <div class="detail-box">
                            <p class="detail-label">ê³„ì•½ ê¸°ê°„</p>
                            <p class="detail-value">{contractStartDate} ~ {contractEndDate}</p>
                            <p class="detail-link highlight">ì¬ê³„ì•½ í˜‘ìƒ ê°€ëŠ¥ (D-{daysUntilContractEnd})</p>
                        </div>
                        <div class="detail-box">
                            <p class="detail-label">ë³´ì¦ê¸ˆ (Deposit)</p>
                            <p class="detail-value">{depositAmount}</p>
                            <p class="detail-link success">ë‚©ë¶€ ì™„ë£Œ (Paid)</p>
                        </div>
                        <div class="detail-box">
                            <p class="detail-label">ì›” ì´ìš©ë£Œ (Monthly)</p>
                            <p class="detail-value">{monthlyPayment}</p>
                            <p class="detail-note">(ë¶€ê°€ì„¸ í¬í•¨)</p>
                        </div>
                        <div class="detail-box">
                            <p class="detail-label">ë‚©ë¶€ì¼</p>
                            <p class="detail-value">{billingCycle}</p>
                            <p class="detail-note">(ìµì›” ê²°ì œ)</p>
                        </div>
                    </div>
                </div>

                <div class="content-grid charge-grid">
                    <div class="billing-section">
                        <div class="section-header-row">
                            <h3>ì²­êµ¬ ë° ë‚©ë¶€ ë‚´ì—­</h3>
                            <select class="year-selector">
                                <option>2026ë…„</option>
                                <option>2025ë…„</option>
                            </select>
                        </div>

                        <table class="billing-table">
                            <thead>
                                <tr>
                                    <th>ì²­êµ¬ì›”</th>
                                    <th>ì²­êµ¬ ê¸ˆì•¡</th>
                                    <th>ë‚©ë¶€ ê¸°í•œ</th>
                                    <th>ìƒíƒœ</th>
                                    <th>ì˜ìˆ˜ì¦</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template if:true={hasInvoices}>
                                    <template for:each={formattedInvoices} for:item="inv">
                                        <tr key={inv.invoiceId} class={inv.rowClass}>
                                            <td>{inv.billingMonthDisplay}</td>
                                            <td>{inv.amountDisplay}</td>
                                            <td class="due-date">{inv.dueDateDisplay}</td>
                                            <td><span class={inv.statusClass}>{inv.statusDisplay}</span></td>
                                            <td><a onclick={openReceipt} class="link-pdf">PDF ë³´ê¸°</a></td>
                                        </tr>
                                    </template>
                                </template>
                                <template if:false={hasInvoices}>
                                    <tr>
                                        <td colspan="5" class="empty-cell">ì²­êµ¬ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>

                    <div class="info-section">
                        <div class="info-card">
                            <h3 class="card-title">ë‚©ë¶€ ê³„ì¢Œ ì •ë³´</h3>
                            <div class="account-info-highlight">
                                <p class="account-label">ì…ê¸ˆ ê°€ìƒê³„ì¢Œ (Virtual Account)</p>
                                <p class="account-number">ìš°ë¦¬ 1002-123-456789</p>
                                <p class="account-holder">ì˜ˆê¸ˆì£¼: (ì£¼)ìœ„ê·¸ë¡œìš°_ë¸”ë£¨í…Œí¬</p>
                            </div>
                            <p class="info-note warning-text">
                                * ë‚©ë¶€ ê¸°í•œì´ ì§€ë‚œ ê²½ìš°, ìµì›” 10ì¼ê¹Œì§€ ë¯¸ë‚© ì‹œ ì—°ì²´ë£Œê°€ ë¶€ê³¼ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                            </p>
                            <p class="info-note">
                                ë‚©ë¶€ ê¸°í•œ ê²½ê³¼ ì‹œ 3ì˜ì—…ì¼ ì´ë‚´ ì—°ì²´ë£Œ 12%ê°€ ë¶€ê³¼ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                            </p>
                        </div>

                        <div class="info-card">
                            <h3 class="card-title">ì„¸ê¸ˆê³„ì‚°ì„œ ì •ë³´</h3>
                            <div class="tax-info">
                                <div class="tax-row">
                                    <span class="tax-label">ì‚¬ì—…ì ë²ˆí˜¸</span>
                                    <span class="tax-value">{bizRegistrationNo}</span>
                                </div>
                                <div class="tax-row">
                                    <span class="tax-label">ìƒí˜¸ëª…</span>
                                    <span class="tax-value">{companyName}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </template>





        </div>
    </div>

    <!-- Case Detail Modal -->
    <template if:true={showCaseModal}>
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open case-modal">
            <div class="slds-modal__container">
                <header class="slds-modal__header">
                    <button class="slds-button slds-button_icon slds-modal__close" onclick={closeCaseModal}>
                        <span class="close-icon">âœ•</span>
                    </button>
                    <h2 class="slds-modal__title">ë¯¼ì› ìƒì„¸ ì •ë³´</h2>
                </header>
                <div class="slds-modal__content modal-content">
                    <div class="case-detail-grid">
                        <div class="detail-row">
                            <span class="detail-label">ë¯¼ì› ë²ˆí˜¸</span>
                            <span class="detail-value">{selectedCase.caseNumber}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">ì œëª©</span>
                            <span class="detail-value">{selectedCase.subject}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">ìœ í˜•</span>
                            <span class="detail-value">{selectedCase.caseType}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">ìƒíƒœ</span>
                            <span class={selectedCase.statusClass}>{selectedCase.status}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">ìš°ì„ ìˆœìœ„</span>
                            <span class="detail-value">{selectedCase.priority}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">ì ‘ìˆ˜ì¼</span>
                            <span class="detail-value">{selectedCase.CreatedDateFormatted}</span>
                        </div>
                        <div class="detail-row full-width">
                            <span class="detail-label">ìƒì„¸ ë‚´ìš©</span>
                            <p class="detail-description">{selectedCaseDescription}</p>
                        </div>
                    </div>
                </div>
                <footer class="slds-modal__footer">
                    <button class="btn-modal-close" onclick={closeCaseModal}>ë‹«ê¸°</button>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open" onclick={closeCaseModal}></div>
    </template>
</template>
