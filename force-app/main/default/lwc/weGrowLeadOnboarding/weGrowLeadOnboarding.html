<template>
    <div class="main-container">
        
        <!-- 글로벌 헤더 with 네비게이션 -->
        <header class="top-header">
            <div class="header-left">
                <div class="logo-container" onclick={goToHome}>
                    <span class="logo-icon">○</span><span class="logo-text">WE-GROW</span>
                </div>
                <nav class="header-nav">
                    <button class={locationsNavClass} onclick={goToLocations}>지점 위치</button>
                    <button class={productsNavClass} onclick={goToProducts}>상품 안내</button>
                    <button class={aboutNavClass} onclick={goToAbout}>기업 소개</button>
                </nav>
            </div>
            <div class="header-right">
                <template if:true={showAIStatus}>
                    <div class="agent-status">
                        <span class="status-dot"></span><span>AI Agent 대기중</span>
                    </div>
                </template>
                <button class="btn-ai-search" onclick={goToHome}>
                    <span class="ai-icon">🔍</span><span>AI 공간 찾기</span>
                </button>
            </div>
        </header>

        <template if:true={isStep1}>
            <div class="step-container fade-in step1-container">
                <div class="bg-overlay"></div>
                <div class="landing-content">
                    <h1 class="landing-title">
                        AI의 속도로 찾는<br/><span class="gradient-text">당신만의 완벽한 오피스</span>
                    </h1>
                    <p class="landing-desc">
                        팀 규모, 선호 지역, 원하는 분위기만 말씀해 주세요.<br/>
                        AI 에이전트가 실시간 공실 데이터에서 최적의 공간을 찾아드립니다.
                    </p>
                    <div class="search-box">
                        <span class="search-icon">○</span>
                        <input type="text" class="prompt-input" 
                               placeholder="예: 강남역 채광 좋은 4인실 찾아줘" 
                               value={userPrompt} onchange={handlePromptInput} onkeyup={handleKeyPress}>
                        <button class="btn-search" onclick={goToStep2}><span class="arrow-icon">→</span></button>
                    </div>
                    <div class="suggestion-tags">
                        <button class="tag-btn" onclick={handleTagClick} data-tag="강남역 4인실 오피스">
                            <span class="tag-icon building">🏢</span><span>강남역 4인실 오피스</span>
                        </button>
                        <button class="tag-btn" onclick={handleTagClick} data-tag="을지로 채광 좋은 오피스">
                            <span class="tag-icon studio">🏯</span><span>을지로 채광 좋은 오피스</span>
                        </button>
                        <button class="tag-btn" onclick={handleTagClick} data-tag="판교 10인실">
                            <span>💻 판교 10인실</span>
                        </button>
                    </div>
                </div>
            </div>
        </template>

        <template if:true={isStep2}>
            <div class="step-container fade-in center-content">
                <div class="ai-loader">
                    <div class="loader-circle"><span class="refresh-icon">⟳</span></div>
                    <div class="pulse-ring"></div>
                </div>
                <h2 class="loading-text">AI가 분석 중입니다...</h2>
                <p class="loading-sub">"<span class="highlight">{userPrompt}</span>" 조건에 맞는 공간을 찾고 있습니다.</p>
            </div>
        </template>

        <template if:true={isStep3}>
            <div class="step-container fade-in step3-container">
                <div class="result-header">
                    <div class="result-left">
                        <div class="status-badge"><span class="status-indicator"></span><span>AI 분석 및 매칭 완료</span></div>
                        <h1 class="result-title">고객님을 위한 <span class="highlight-blue">BEST 공간</span>을 찾았습니다.</h1>
                    </div>
                    <button class="btn-retry" onclick={resetProcess}>
                        <span class="search-icon-small">🔍</span><span>다시 검색하기</span>
                    </button>
                </div>
                
                <div class="card-grid">
                    <template if:false={hasResults}>
                        <div class="no-result" style="color:white; text-align:center; width:100%; padding:50px;">
                            조건에 맞는 공실 오피스가 없습니다.
                        </div>
                    </template>

                    <template for:each={recommendations} for:item="space">
                        <div key={space.id} class={space.cardClass} onclick={handleCardClick} data-id={space.id}>
                            <!-- 선택 표시 -->
                            <template if:true={space.isSelected}>
                                <div class="selection-badge">✓</div>
                            </template>
                            <div class="card-img-wrapper">
                                <img src={space.imageUrl} alt={space.name} class="card-img" />
                                <span class="badge-match"><span class="match-dot"></span>적합도 {space.matchRate}%</span>
                            </div>
                            <div class="card-info">
                                <h3 class="card-title">{space.name}</h3>
                                <p class="card-location"><span class="location-icon">📍</span>{space.location}</p>
                                <div class="card-tags">
                                    <span class="card-tag">{space.capacityNumber}인실</span>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
                
                <!-- 신청하기 버튼 (선택이 있을 때만 표시) -->
                <template if:true={hasSelection}>
                    <div class="floating-apply-btn">
                        <button class="btn-apply" onclick={goToStep5}>
                            <span class="apply-icon">📝</span>
                            <span>{applyButtonText}</span>
                            <span class="apply-arrow">→</span>
                        </button>
                    </div>
                </template>
            </div>
        </template>

        <template if:true={isDetailView}>
            <div class="detail-view-container">
                <div class="detail-background">
                    <div class="detail-split-view">
                        <div class="detail-image-section">
                            <img src={selectedSpace.imageUrl} class="detail-full-image" />
                            <div class="detail-image-overlay">
                                <div class="detail-space-info">
                                    <h2 class="detail-space-name">{selectedSpace.name}</h2>
                                    <p class="detail-space-location">📍 {selectedSpace.location}</p>
                                </div>
                            </div>
                        </div>
                        <div class="detail-info-panel">
                            <button class="panel-close" onclick={goBackToStep3}>×</button>
                            <div class="panel-price-row">
                                <div class="panel-price-item">
                                    <span class="price-label-small">수용 인원</span>
                                    <div class="panel-capacity"><span class="capacity-number">{selectedSpace.capacityNumber}</span>인</div>
                                </div>
                            </div>
                            <div class="panel-section">
                                <h3 class="section-title">공간 소개</h3>
                                <p class="section-desc">{selectedSpace.description}</p>
                            </div>
                            <div class="panel-section">
                                <h3 class="section-title">편의 시설</h3>
                                <div class="amenity-grid">
                                    <template for:each={selectedSpace.amenities} for:item="amenity">
                                        <div key={amenity.name} class="amenity-item"><span class="amenity-check">✓</span><span>{amenity.name}</span></div>
                                    </template>
                                </div>
                            </div>
                            <button class="btn-cta" onclick={goToStep5}>
                                <span>투어 예약 및 견적 신청</span><span class="cta-arrow">→</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </template>

        <template if:true={isStep5}>
            <div class="modal-overlay fade-in">
                <div class="form-modal slide-up" style="background: white; padding: 2rem; border-radius: 16px; max-width: 600px; width: 90%;">
                    <div class="form-modal-header">
                        <button class="panel-close" onclick={goBackToStep3} style="float:right; font-size:1.5rem; background:none; border:none; cursor:pointer;">×</button>
                        <div class="form-icon"><span>📋</span></div>
                        <h2 class="form-title" style="color:#111; margin-top:10px;">자세한 내용 이메일로 받아보기</h2>
                        <div class="selected-offices-list" style="margin-top:12px;">
                            <p style="color:#666; font-size:0.9rem; margin-bottom:8px;">선택하신 공간:</p>
                            <template for:each={selectedSpaces} for:item="space">
                                <span key={space.id} class="selected-office-tag">{space.name}</span>
                            </template>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <lightning-flow
                            flow-api-name="Create_Lead_with_Screen_Flow"
                            flow-input-variables={flowInputVariables}
                            onstatuschange={handleFlowStatusChange}>
                        </lightning-flow>
                    </div>
                </div>
            </div>
        </template>

        <template if:true={isStep7}>
            <div class="modal-overlay fade-in">
                <div class="success-modal slide-up">
                    <div class="success-check"><span>✓</span></div>
                    <h2 class="success-title">접수가 완료되었습니다!</h2>
                    <p class="success-desc">
                        위그로우 전담 매니저가 배정되었습니다.
                    </p>
                    <button class="btn-home" onclick={resetProcess}>처음으로 돌아가기</button>
                </div>
            </div>
        </template>

        <!-- ============================================
             지점 위치 페이지 (LOCATIONS)
             ============================================ -->
        <template if:true={isLocationsPage}>
            <div class="page-container fade-in locations-page">
                <div class="locations-layout">
                    <!-- 좌측: 지도 영역 -->
                    <div class="map-section">
                        <div class="map-container">
                            <!-- 서울/경기 지도 목업 이미지 (Static Resource) -->
                            <img src={koreaMapUrl}
                                 alt="대한민국 지도" 
                                 class="map-background" />
                            
                            <!-- 지점 마커들 - 실제 위치 기준 -->
                            <div class="map-markers">
                                <!-- 강남점: 서울 강남구 테헤란로 (127.028, 37.498) -->
                                <div class="map-marker gangnam" onclick={goToGangnam}>
                                    <div class="marker-pin"></div>
                                    <div class="marker-label">
                                        <strong>강남점</strong>
                                        <span class="marker-address">테헤란로 123</span>
                                    </div>
                                </div>
                                
                                <!-- 을지로점: 서울 중구 을지로 (126.982, 37.566) -->
                                <div class="map-marker euljiro" onclick={goToEuljiro}>
                                    <div class="marker-pin"></div>
                                    <div class="marker-label">
                                        <strong>을지로점</strong>
                                        <span class="marker-address">을지로 45</span>
                                    </div>
                                </div>
                                
                                <!-- 판교점: 경기 성남시 판교 (127.111, 37.394) -->
                                <div class="map-marker pangyo" onclick={goToPangyo}>
                                    <div class="marker-pin"></div>
                                    <div class="marker-label">
                                        <strong>판교점</strong>
                                        <span class="marker-address">판교로 256</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 지도 컨트롤 UI -->
                            <div class="map-controls">
                                <button class="map-control-btn">+</button>
                                <button class="map-control-btn">−</button>
                            </div>
                            
                            <!-- 지도 범례 -->
                            <div class="map-legend">
                                <span class="legend-dot"></span>
                                <span>WE-GROW 지점</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 우측: 지점 카드 목록 -->
                    <div class="branches-section">
                        <div class="branches-header">
                            <h1 class="page-title">WE-GROW <span class="highlight-purple">지점 안내</span></h1>
                            <p class="page-subtitle">최적의 입지와 프리미엄 시설을 갖춘 WE-GROW 오피스를 만나보세요.</p>
                        </div>
                        
                        <div class="branches-list">
                            <!-- 강남점 -->
                            <div class="branch-card" onclick={handleBranchClick} data-branch="gangnam">
                                <div class="branch-badge">HOT</div>
                                <div class="branch-info">
                                    <h3 class="branch-name">강남점</h3>
                                    <p class="branch-address">📍 서울 강남구 테헤란로 123</p>
                                    <div class="branch-tags">
                                        <span class="branch-tag">지하철 2분</span>
                                        <span class="branch-tag">24시간</span>
                                        <span class="branch-tag">주차가능</span>
                                    </div>
                                    <div class="branch-stats">
                                        <div class="stat-item">
                                            <span class="stat-value">120</span>
                                            <span class="stat-label">총 좌석</span>
                                        </div>
                                        <div class="stat-item">
                                            <span class="stat-value">15</span>
                                            <span class="stat-label">오피스</span>
                                        </div>
                                        <div class="stat-item available">
                                            <span class="stat-value">3</span>
                                            <span class="stat-label">공실</span>
                                        </div>
                                    </div>
                                </div>
                                <button class="btn-branch-detail">상세보기 →</button>
                            </div>
                            
                            <!-- 을지로점 -->
                            <div class="branch-card" onclick={handleBranchClick} data-branch="euljiro">
                                <div class="branch-badge new">NEW</div>
                                <div class="branch-info">
                                    <h3 class="branch-name">을지로점</h3>
                                    <p class="branch-address">📍 서울 중구 을지로 45</p>
                                    <div class="branch-tags">
                                        <span class="branch-tag">힙한 분위기</span>
                                        <span class="branch-tag">루프탑</span>
                                        <span class="branch-tag">카페</span>
                                    </div>
                                    <div class="branch-stats">
                                        <div class="stat-item">
                                            <span class="stat-value">80</span>
                                            <span class="stat-label">총 좌석</span>
                                        </div>
                                        <div class="stat-item">
                                            <span class="stat-value">10</span>
                                            <span class="stat-label">오피스</span>
                                        </div>
                                        <div class="stat-item available">
                                            <span class="stat-value">5</span>
                                            <span class="stat-label">공실</span>
                                        </div>
                                    </div>
                                </div>
                                <button class="btn-branch-detail">상세보기 →</button>
                            </div>
                            
                            <!-- 판교점 -->
                            <div class="branch-card" onclick={handleBranchClick} data-branch="pangyo">
                                <div class="branch-info">
                                    <h3 class="branch-name">판교점</h3>
                                    <p class="branch-address">📍 경기 성남시 판교로 256</p>
                                    <div class="branch-tags">
                                        <span class="branch-tag">IT 밸리</span>
                                        <span class="branch-tag">넓은 공간</span>
                                        <span class="branch-tag">회의실 多</span>
                                    </div>
                                    <div class="branch-stats">
                                        <div class="stat-item">
                                            <span class="stat-value">200</span>
                                            <span class="stat-label">총 좌석</span>
                                        </div>
                                        <div class="stat-item">
                                            <span class="stat-value">25</span>
                                            <span class="stat-label">오피스</span>
                                        </div>
                                        <div class="stat-item available">
                                            <span class="stat-value">8</span>
                                            <span class="stat-label">공실</span>
                                        </div>
                                    </div>
                                </div>
                                <button class="btn-branch-detail">상세보기 →</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </template>

        <!-- ============================================
             상품 안내 페이지 (PRODUCTS)
             ============================================ -->
        <template if:true={isProductsPage}>
            <div class="page-container fade-in products-page">
                <!-- 히어로 섹션 -->
                <div class="products-hero">
                    <div class="hero-overlay"></div>
                    <div class="hero-content">
                        <span class="hero-badge">PREMIUM OFFICE</span>
                        <h1 class="hero-title">팀에 맞는 <span class="gradient-text">완벽한 공간</span></h1>
                        <p class="hero-desc">1인부터 대규모 팀까지, 모든 성장 단계에 맞춘 오피스 솔루션</p>
                    </div>
                </div>
                
                <!-- 상품 카드 그리드 -->
                <div class="products-section">
                    <div class="products-grid">
                        <!-- 1인실 -->
                        <div class="product-card" onclick={handleProductClick} data-product="1person">
                            <div class="product-image" style="background-image: url('https://images.unsplash.com/photo-1497366216548-37526070297c?w=400&q=80')">
                                <div class="product-overlay">
                                    <span class="product-capacity">1인실</span>
                                </div>
                            </div>
                            <div class="product-info">
                                <h3 class="product-name">Solo Office</h3>
                                <p class="product-desc">혼자 집중하기 좋은 1인 전용 공간</p>
                                <div class="product-features">
                                    <span>✓ 개인 데스크</span>
                                    <span>✓ 무료 WiFi</span>
                                    <span>✓ 락커</span>
                                </div>
                                <div class="product-price">
                                    <span class="price-from">월</span>
                                    <span class="price-amount">50만원</span>
                                    <span class="price-suffix">부터</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 4인실 -->
                        <div class="product-card popular" onclick={handleProductClick} data-product="4person">
                            <div class="popular-badge">BEST</div>
                            <div class="product-image" style="background-image: url('https://images.unsplash.com/photo-1524758631624-e2822e304c36?w=400&q=80')">
                                <div class="product-overlay">
                                    <span class="product-capacity">4인실</span>
                                </div>
                            </div>
                            <div class="product-info">
                                <h3 class="product-name">Team Office</h3>
                                <p class="product-desc">소규모 팀에 최적화된 협업 공간</p>
                                <div class="product-features">
                                    <span>✓ 개별 책상 4개</span>
                                    <span>✓ 미팅 테이블</span>
                                    <span>✓ 화이트보드</span>
                                </div>
                                <div class="product-price">
                                    <span class="price-from">월</span>
                                    <span class="price-amount">180만원</span>
                                    <span class="price-suffix">부터</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 8인실 -->
                        <div class="product-card" onclick={handleProductClick} data-product="8person">
                            <div class="product-image" style="background-image: url('https://images.unsplash.com/photo-1556761175-5973dc0f32e7?w=400&q=80')">
                                <div class="product-overlay">
                                    <span class="product-capacity">8인실</span>
                                </div>
                            </div>
                            <div class="product-info">
                                <h3 class="product-name">Growth Office</h3>
                                <p class="product-desc">성장하는 팀을 위한 넓은 공간</p>
                                <div class="product-features">
                                    <span>✓ 개별 책상 8개</span>
                                    <span>✓ 프라이빗 미팅룸</span>
                                    <span>✓ 폰부스 이용</span>
                                </div>
                                <div class="product-price">
                                    <span class="price-from">월</span>
                                    <span class="price-amount">320만원</span>
                                    <span class="price-suffix">부터</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 10인실+ -->
                        <div class="product-card enterprise" onclick={handleProductClick} data-product="enterprise">
                            <div class="product-image" style="background-image: url('https://images.unsplash.com/photo-1497215728101-856f4ea42174?w=400&q=80')">
                                <div class="product-overlay">
                                    <span class="product-capacity">10인+</span>
                                </div>
                            </div>
                            <div class="product-info">
                                <h3 class="product-name">Enterprise Office</h3>
                                <p class="product-desc">대규모 팀을 위한 맞춤형 공간</p>
                                <div class="product-features">
                                    <span>✓ 맞춤 레이아웃</span>
                                    <span>✓ 전용 회의실</span>
                                    <span>✓ 브랜딩 가능</span>
                                </div>
                                <div class="product-price">
                                    <span class="price-consult">별도 상담</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- CTA 섹션 -->
                    <div class="products-cta">
                        <p class="cta-text">어떤 공간이 맞을지 고민되시나요?</p>
                        <button class="btn-cta-primary" onclick={goToHome}>
                            <span>🤖 AI가 추천해드릴게요</span><span class="cta-arrow">→</span>
                        </button>
                    </div>
                </div>
            </div>
        </template>

        <!-- ============================================
             기업 소개 페이지 (ABOUT)
             ============================================ -->
        <template if:true={isAboutPage}>
            <div class="page-container fade-in about-page">
                <div class="about-content">
                    <!-- 메인 비전 -->
                    <div class="about-hero-section">
                        <span class="about-badge">ABOUT WE-GROW</span>
                        <h1 class="about-title">
                            일하는 방식의<br/>
                            <span class="gradient-text">새로운 기준</span>을 만듭니다
                        </h1>
                        <p class="about-subtitle">
                            WE-GROW는 혁신적인 공유 오피스 경험을 통해<br/>
                            비즈니스 성장을 돕는 프리미엄 워크스페이스입니다.
                        </p>
                    </div>
                    
                    <!-- 미션/비전 카드 -->
                    <div class="about-cards">
                        <div class="about-card">
                            <div class="card-icon">🎯</div>
                            <h3 class="card-title">Mission</h3>
                            <p class="card-desc">모든 팀이 최고의 환경에서<br/>최고의 성과를 낼 수 있도록</p>
                        </div>
                        <div class="about-card">
                            <div class="card-icon">🚀</div>
                            <h3 class="card-title">Vision</h3>
                            <p class="card-desc">대한민국 No.1<br/>프리미엄 공유 오피스</p>
                        </div>
                        <div class="about-card">
                            <div class="card-icon">💡</div>
                            <h3 class="card-title">Value</h3>
                            <p class="card-desc">혁신, 연결, 성장<br/>Innovation · Connection · Growth</p>
                        </div>
                    </div>
                    
                    <!-- 주요 통계 -->
                    <div class="about-stats">
                        <div class="stat-box">
                            <span class="stat-number">3</span>
                            <span class="stat-unit">개</span>
                            <p class="stat-desc">프리미엄 지점</p>
                        </div>
                        <div class="stat-box">
                            <span class="stat-number">400+</span>
                            <span class="stat-unit">석</span>
                            <p class="stat-desc">총 좌석 수</p>
                        </div>
                        <div class="stat-box">
                            <span class="stat-number">150+</span>
                            <span class="stat-unit">팀</span>
                            <p class="stat-desc">입주 기업</p>
                        </div>
                        <div class="stat-box">
                            <span class="stat-number">98</span>
                            <span class="stat-unit">%</span>
                            <p class="stat-desc">고객 만족도</p>
                        </div>
                    </div>
                    
                    <!-- 연락처 -->
                    <div class="about-contact">
                        <h2 class="contact-title">문의하기</h2>
                        <div class="contact-info">
                            <div class="contact-item">
                                <span class="contact-icon">📧</span>
                                <span>contact@wegrow.co.kr</span>
                            </div>
                            <div class="contact-item">
                                <span class="contact-icon">📞</span>
                                <span>02-1234-5678</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </template>
        
    </div>
</template>