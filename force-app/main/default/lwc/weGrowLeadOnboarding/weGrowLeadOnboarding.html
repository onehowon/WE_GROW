<template>
    <div class="main-container">
        
        <template if:true={showHeader}>
            <header class="top-header">
                <div class="header-left">
                    <div class="logo-container">
                        <span class="logo-icon">○</span><span class="logo-text">WE-GROW</span>
                    </div>
                </div>
                <div class="header-right">
                    <div class="agent-status">
                        <span class="status-dot"></span><span>AI Agent 대기중</span>
                    </div>
                </div>
            </header>
        </template>

        <template if:true={isStep1}>
            <div class="step-container fade-in step1-container">
                <div class="bg-overlay"></div>
                <div class="landing-content">
                    <div class="finder-badge">
                        <span class="badge-icon">○</span><span>Agentforce based Workspace Finder</span>
                    </div>
                    <h1 class="landing-title">
                        AI의 속도로 찾는<br/><span class="gradient-text">당신만의 완벽한 오피스</span>
                    </h1>
                    <p class="landing-desc">
                        팀 규모, 선호 지역, 원하는 분위기만 말씀해 주세요.<br/>
                        AI 에이전트가 실시간 공실 데이터에서 최적의 공간을 찾아드립니다.
                    </p>
                    <div class="search-box">
                        <span class="search-icon">○</span>
                        <input type="text" class="prompt-input" 
                               placeholder="예: 강남역 채광 좋은 4인실 찾아줘" 
                               value={userPrompt} onchange={handlePromptInput}>
                        <button class="btn-search" onclick={goToStep2}><span class="arrow-icon">→</span></button>
                    </div>
                    <div class="suggestion-tags">
                        <button class="tag-btn" onclick={handleTagClick} data-tag="강남역 4인실">
                            <span class="tag-icon building">🏢</span><span>강남역 4인실 오피스 추천해줘</span>
                        </button>
                        <button class="tag-btn" onclick={handleTagClick} data-tag="성수동 스튜디오">
                            <span class="tag-icon studio">🎨</span><span>을지로 채광 좋은 오피스 추천해줘</span>
                        </button>
                    </div>
                </div>
            </div>
        </template>

        <template if:true={isStep2}>
            <div class="step-container fade-in center-content">
                <div class="ai-loader">
                    <div class="loader-circle"><span class="refresh-icon">⟳</span></div>
                    <div class="pulse-ring"></div>
                </div>
                <h2 class="loading-text">AI가 분석 중입니다...</h2>
                <p class="loading-sub">"<span class="highlight">{userPrompt}</span>" 조건에 맞는 공간을 찾고 있습니다.</p>
            </div>
        </template>

        <template if:true={isStep3}>
            <div class="step-container fade-in step3-container">
                <div class="result-header">
                    <div class="result-left">
                        <div class="status-badge"><span class="status-indicator"></span><span>AI 분석 및 매칭 완료</span></div>
                        <h1 class="result-title">고객님을 위한 <span class="highlight-blue">BEST 공간</span>을 찾았습니다.</h1>
                    </div>
                    <button class="btn-retry" onclick={resetProcess}>
                        <span class="search-icon-small">🔍</span><span>다시 검색하기</span>
                    </button>
                </div>
                
                <div class="card-grid">
                    <template if:false={hasResults}>
                        <div class="no-result" style="color:white; text-align:center; width:100%; padding:50px;">
                            조건에 맞는 공실 오피스가 없습니다.
                        </div>
                    </template>

                    <template for:each={recommendations} for:item="space">
                        <div key={space.id} class="space-card" onclick={handleCardClick} data-id={space.id}>
                            <div class="card-img-wrapper">
                                <img src={space.imageUrl} alt={space.name} class="card-img" />
                                <span class="badge-match"><span class="match-dot"></span>적합도 {space.matchRate}%</span>
                            </div>
                            <div class="card-info">
                                <h3 class="card-title">{space.name}</h3>
                                <p class="card-location"><span class="location-icon">📍</span>{space.location}</p>
                                <div class="card-tags">
                                    <span class="card-tag">{space.capacityNumber}인실</span>
                                </div>
                                <div class="card-footer">
                                    <div class="price-info">
                                        <span class="price-label">월 이용료</span>
                                        <div class="price-value">
                                            <span class="price-number">{space.priceNumber}</span><span class="price-unit">원</span>
                                        </div>
                                    </div>
                                    <button class="btn-arrow"><span>→</span></button>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </template>

        <template if:true={isDetailView}>
            <div class="detail-view-container">
                <div class="detail-background">
                    <div class="detail-split-view">
                        <div class="detail-image-section">
                            <img src={selectedSpace.imageUrl} class="detail-full-image" />
                            <div class="detail-image-overlay">
                                <div class="detail-space-info">
                                    <h2 class="detail-space-name">{selectedSpace.name}</h2>
                                    <p class="detail-space-location">📍 {selectedSpace.location}</p>
                                </div>
                            </div>
                        </div>
                        <div class="detail-info-panel">
                            <button class="panel-close" onclick={goBackToStep3}>×</button>
                            <div class="panel-price-row">
                                <div class="panel-price-item">
                                    <span class="price-label-small">월 이용료</span>
                                    <div class="panel-price"><span class="price-big">{selectedSpace.priceNumber}</span>원</div>
                                </div>
                                <div class="panel-price-item">
                                    <span class="price-label-small">수용 인원</span>
                                    <div class="panel-capacity"><span class="capacity-number">{selectedSpace.capacityNumber}</span>인</div>
                                </div>
                            </div>
                            <div class="panel-section">
                                <h3 class="section-title">공간 소개</h3>
                                <p class="section-desc">{selectedSpace.description}</p>
                            </div>
                            <div class="panel-section">
                                <h3 class="section-title">편의 시설</h3>
                                <div class="amenity-grid">
                                    <template for:each={selectedSpace.amenities} for:item="amenity">
                                        <div key={amenity.name} class="amenity-item"><span class="amenity-check">✓</span><span>{amenity.name}</span></div>
                                    </template>
                                </div>
                            </div>
                            <button class="btn-cta" onclick={goToStep5}>
                                <span>투어 예약 및 견적 신청</span><span class="cta-arrow">→</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </template>

        <template if:true={isStep5}>
            <div class="modal-overlay fade-in">
                <div class="form-modal slide-up" style="background: white; padding: 2rem; border-radius: 16px; max-width: 600px; width: 90%;">
                    <div class="form-modal-header">
                        <button class="panel-close" onclick={goToStep4} style="float:right; font-size:1.5rem; background:none; border:none; cursor:pointer;">×</button>
                        <div class="form-icon"><span>📋</span></div>
                        <h2 class="form-title" style="color:#111; margin-top:10px;">맞춤 견적 및 투어 신청</h2>
                        <p class="form-subtitle" style="color:#666;">선택하신 공간: <span style="font-weight:bold; color:#5A4FCF;">{selectedSpace.name}</span></p>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <lightning-flow
                            flow-api-name="Create_Lead_with_Screen_Flow"
                            flow-input-variables={flowInputVariables}
                            onstatuschange={handleFlowStatusChange}>
                        </lightning-flow>
                    </div>
                </div>
            </div>
        </template>

        <template if:true={isStep7}>
            <div class="modal-overlay fade-in">
                <div class="success-modal slide-up">
                    <div class="success-check"><span>✓</span></div>
                    <h2 class="success-title">접수가 완료되었습니다!</h2>
                    <p class="success-desc">
                        위그로우 전담 매니저가 배정되었습니다.<br/>
                        <span class="highlight-text">3일 이내</span>로 안내 연락을 드리겠습니다.
                    </p>
                    <button class="btn-home" onclick={resetProcess}>처음으로 돌아가기</button>
                </div>
            </div>
        </template>
        
    </div>
</template>